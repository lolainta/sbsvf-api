syntax = "proto3";

package sbsvf_api;

import "config.proto";
import "control.proto";
import "empty.proto";
import "object.proto";
import "path.proto";
import "pong.proto";
import "scenario.proto";

service SimServer {
  // Check if the server is alive
  rpc Ping(Empty) returns (Pong);

  // Initialize the simulation (e.g., load maps, set weather)
  rpc Init(SimServerMessages.InitRequest) returns (SimServerMessages.InitResponse);

  // Reset the simulation with a new scenario
  rpc Reset(SimServerMessages.ResetRequest) returns (SimServerMessages.ResetResponse);

  // Advance the simulation by one step with the provided control command
  rpc Step(SimServerMessages.StepRequest) returns (SimServerMessages.StepResponse);

  // Stop the simulation
  rpc Stop(Empty) returns (Empty);

  // Check if the simulation should quit
  rpc ShouldQuit(Empty) returns (SimServerMessages.ShouldQuitResponse);
}

message SimServerMessages {
  message InitRequest {
    Config config = 1;
    double dt     = 2;
  }

  message InitResponse {
    bool   success = 1;
    string msg     = 2;
  }

  message ResetRequest {
    string              output_dir    = 1;
    ScenarioPack        scenario_pack = 2;
    map<string, string> params        = 3;
  }

  message ResetResponse {
    repeated ObjectState objects = 1;
  }

  message StepRequest {
    CtrlCmd ctrl_cmd     = 1;
    int64   timestamp_ns = 2;
  }

  message StepResponse {
    repeated ObjectState objects = 1;
  }

  message ShouldQuitResponse {
    bool should_quit = 1;
  }
}
