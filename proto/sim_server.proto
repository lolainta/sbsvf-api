syntax = "proto3";

package sbsvf_api;

import "config.proto";
import "control.proto";
import "empty.proto";
import "object.proto";
import "path.proto";
import "pong.proto";
import "scenario.proto";

service SimServer {
  // Check if the server is alive
  rpc Ping(Empty) returns (Pong);

  // Initialize the simulation (e.g., load maps, set weather)
  rpc Init(InitRequest) returns (InitResponse);

  // Reset the simulation with a new scenario
  rpc Reset(ResetRequest) returns (ResetResponse);

  // Advance the simulation by one step with the provided control command
  rpc Step(StepRequest) returns (StepResponse);

  // Stop the simulation
  rpc Stop(Empty) returns (Empty);

  // Check if the simulation should quit
  rpc ShouldQuit(Empty) returns (ShouldQuitResponse);
}

message InitRequest {
  Config config = 1;
  double dt     = 2;
}

message InitResponse {
  bool   success = 1;
  string msg     = 2;
}

message StepRequest {
  CtrlCmd ctrl_cmd     = 1;
  int64   timestamp_ns = 2;
}

message StepResponse {
  repeated ObjectState objects = 1;
}

message ResetRequest {
  string              output_dir    = 1;
  ScenarioPack        scenario_pack = 2;
  map<string, string> params        = 3;
}

message ResetResponse {
  repeated ObjectState objects = 1;
}

message ShouldQuitResponse {
  bool should_quit = 1;
}
